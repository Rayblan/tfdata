<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»ˆæè§’é€æ¸¸æˆé“å…·</title>

    <script src="vue.global.js"></script>
    <link rel="stylesheet" href="all.min.css">
    <link rel="stylesheet" href="tfdatarank3.css">

</head>

<body>
    <div id="app">
        <div class="container">
            <header>
                <div class="title-container">
                    <h1>ç»ˆæè§’é€æ¸¸æˆé“å…·</h1>
                    <a href="https://space.bilibili.com/85550309" class="author-link">æ¬¢è¿å…³æ³¨ Bç«™ï¼šå“¥å¸ƒæ—çº¯æ°´</a>
                </div>
                <p class="subtitle">æ¢ç´¢æ‰€æœ‰é“å…·çš„è¯¦ç»†ä¿¡æ¯ä¸ç»Ÿè®¡æ•°æ®</p>

                <div class="search-box">
                    <i class="search-icon">ğŸ”</i>
                    <input type="text" class="search-input" v-model="searchQuery" placeholder="æœç´¢é“å…·åç§°..." />
                </div>
            </header>
            
            <!-- ä¿®æ”¹åçš„æ ‡ç­¾é¡µéƒ¨åˆ† -->
            <div class="main-tabs">
                <!-- æ­¦å™¨æ•°æ®æŒ‰é’® -->
                <div class="main-tab">
                    <a href="TFdataCN.html" class="tab-link">æ­¦å™¨æ•°æ®</a>
                </div>

                <!-- æ‰‹åŠ¨ç¼–å†™çš„å››ä¸ªæ ‡ç­¾é¡µ -->
                <div class="main-tab" 
                     :class="{ active: activeTab === 'light' }" 
                     @click="activeTab = 'light'">
                    è½»å‹é“å…·
                </div>
                
                <div class="main-tab" 
                     :class="{ active: activeTab === 'medium' }" 
                     @click="activeTab = 'medium'">
                    ä¸­å‹é“å…·
                </div>
                
                <div class="main-tab" 
                     :class="{ active: activeTab === 'heavy' }" 
                     @click="activeTab = 'heavy'">
                    é‡å‹é“å…·
                </div>
                
                <div class="main-tab" 
                     :class="{ active: activeTab === 'universal' }" 
                     @click="activeTab = 'universal'">
                    é€šç”¨é“å…·
                </div>
            </div>

            <div class="gadgets-grid">
                <div v-for="gadget in filteredGadgets" :key="gadget.game" class="gadget-card">
                    <div class="card-header">
                        <h3 class="gadget-name">{{ gadget.game }}</h3>
                        <span class="gadget-build">{{ gadget.Build }}</span>
                        <div class="gadget-type">{{ gadget.Type }}</div>
                    </div>

                    <div class="card-body">
                        <div class="gadget-stats">
                            <!-- <div class="stat-item" v-if="gadget.Price">
                                <span class="stat-label">ä»·æ ¼:</span>
                                <span class="stat-value">{{ gadget.Price }}</span>
                            </div> -->
                            <div class="stat-item" v-if="gadget.Cooldown">
                                <span class="stat-label">å†·å´:</span>
                                <span class="stat-value">{{ gadget.Cooldown }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget.Ammo">
                                <span class="stat-label">å¼¹è¯:</span>
                                <span class="stat-value">{{ gadget.Ammo }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget.Damage">
                                <span class="stat-label">ä¼¤å®³:</span>
                                <span class="stat-value">{{ gadget.Damage }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget.Duration">
                                <span class="stat-label">æŒç»­æ—¶é—´:</span>
                                <span class="stat-value">{{ gadget.Duration }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget['Damage Radius']">
                                <span class="stat-label">ä¼¤å®³åŠå¾„:</span>
                                <span class="stat-value">{{ gadget['Damage Radius'] }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget['Priming Time']">
                                <span class="stat-label">å‡†å¤‡æ—¶é—´:</span>
                                <span class="stat-value">{{ gadget['Priming Time'] }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget['Max Deployed']">
                                <span class="stat-label">æœ€å¤§éƒ¨ç½²:</span>
                                <span class="stat-value">{{ gadget['Max Deployed'] }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget.Health">
                                <span class="stat-label">ç”Ÿå‘½å€¼:</span>
                                <span class="stat-value">{{ gadget.Health }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget['Environment Dmg']">
                                <span class="stat-label">ç¯å¢ƒä¼¤å®³:</span>
                                <span class="stat-value">{{ gadget['Environment Dmg'] }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget['Max Range']">
                                <span class="stat-label">æœ€å¤§èŒƒå›´:</span>
                                <span class="stat-value">{{ gadget['Max Range'] }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget.Radius">
                                <span class="stat-label">åŠå¾„:</span>
                                <span class="stat-value">{{ gadget.Radius }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget.rpm">
                                <span class="stat-label">å°„é€Ÿ:</span>
                                <span class="stat-value">{{ gadget.rpm }}</span>
                            </div>
                            <div class="stat-item" v-if="gadget.Healing">
                                <span class="stat-label">æ²»ç–—é‡:</span>
                                <span class="stat-value">{{ gadget.Healing }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="no-results" v-if="filteredGadgets.length === 0">
                    æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é“å…·
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        // åœ¨å¤–éƒ¨å®šä¹‰å“åº”å¼æ•°æ®
        const gadgetsData = ref([]);
        const gadgetsLight = ref([]);
        const gadgetsMedium = ref([]);
        const gadgetsHeavy = ref([]);
        const gadgetsUniversal = ref([]);
        const loading = ref(true);
        const error = ref(null);

        const loadWeaponData = async () => {
            try {
                loading.value = true;
                error.value = null;

                const response = await fetch('gadgetsDataCN.json');
                if (!response.ok) {
                    throw new Error('æ— æ³•åŠ è½½é“å…·æ•°æ®');
                }

                const data = await response.json();
                gadgetsData.value = data; // ç›´æ¥èµ‹å€¼ï¼Œå› ä¸ºJSONæ˜¯æ•°ç»„

                // è‡ªåŠ¨åˆ†ç±»é“å…·
                autoCategorizeGadgets(data);

            } catch (err) {
                console.error('åŠ è½½é“å…·æ•°æ®å¤±è´¥:', err);
                error.value = err.message;
            } finally {
                loading.value = false;
            }
        };

        // è‡ªåŠ¨åˆ†ç±»é“å…·å‡½æ•°ï¼ˆé€‚é…æ•°ç»„ç»“æ„ï¼‰
        const autoCategorizeGadgets = (gadgetsArray) => {
            gadgetsLight.value = [];
            gadgetsMedium.value = [];
            gadgetsHeavy.value = [];
            gadgetsUniversal.value = [];

            gadgetsArray.forEach(gadgetObj => {
                // å› ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚ { "Breach_Charge": { ... } }
                Object.entries(gadgetObj).forEach(([gadgetName, gadgetData]) => {
                    if (!gadgetData || !gadgetData.Build) return;

                    const build = gadgetData.Build.toString().toLowerCase();

                    // æ£€æŸ¥æ˜¯å¦ä¸ºå…¨èŒä¸šé€šç”¨
                    if (build.includes('all')) {
                        gadgetsUniversal.value.push(gadgetName);
                        return;
                    }

                    // å¤„ç†å•ä¸ªæˆ–å¤šä¸ªèŒä¸š
                    const isLight = build.includes('light');
                    const isMedium = build.includes('medium');
                    const isHeavy = build.includes('heavy');

                    if (isLight) gadgetsLight.value.push(gadgetName);
                    if (isMedium) gadgetsMedium.value.push(gadgetName);
                    if (isHeavy) gadgetsHeavy.value.push(gadgetName);
                });
            });

            console.log('è‡ªåŠ¨åˆ†ç±»ç»“æœ:');
            console.log('Light:', gadgetsLight.value);
            console.log('Medium:', gadgetsMedium.value);
            console.log('Heavy:', gadgetsHeavy.value);
            console.log('Universal:', gadgetsUniversal.value);
        };

        createApp({
            setup() {
                const searchQuery = ref('');
                const activeTab = ref('light');

                // å®šä¹‰é“å…·ç±»å‹æ’åºé¡ºåº
                const gadgetTypeOrder = [
                    'Offensive',    // è¿›æ”»é“å…·
                    'Defensive',    // é˜²å¾¡é“å…·  
                    'Utility'       // è¾…åŠ©é“å…·
                ];

                // æ ¹æ®é“å…·åç§°è·å–é“å…·æ•°æ®
                const getGadgetByName = (name) => {
                    for (const gadgetObj of gadgetsData.value) {
                        if (gadgetObj[name]) {
                            return gadgetObj[name];
                        }
                    }
                    return null;
                };

                // æ ¹æ®é“å…·ç±»å‹è·å–æ’åºç´¢å¼•
                const getGadgetTypeIndex = (gadget) => {
                    if (!gadget || !gadget.Type) return gadgetTypeOrder.length;

                    const type = gadget.Type.toString();
                    const index = gadgetTypeOrder.findIndex(orderType =>
                        type.includes(orderType)
                    );

                    return index !== -1 ? index : gadgetTypeOrder.length;
                };

                // æ ¹æ®å½“å‰é€‰é¡¹å¡è·å–é“å…·åˆ—è¡¨å¹¶æ’åº
                const currentGadgets = computed(() => {
                    let gadgetNames = [];
                    switch (activeTab.value) {
                        case 'light': gadgetNames = gadgetsLight.value; break;
                        case 'medium': gadgetNames = gadgetsMedium.value; break;
                        case 'heavy': gadgetNames = gadgetsHeavy.value; break;
                        case 'universal': gadgetNames = gadgetsUniversal.value; break;
                        default: gadgetNames = gadgetsLight.value;
                    }

                    // è·å–é“å…·æ•°æ®å¹¶æ’åº
                    const gadgets = gadgetNames.map(name => getGadgetByName(name)).filter(Boolean);

                    // æŒ‰ç…§é“å…·ç±»å‹é¡ºåºæ’åº
                    gadgets.sort((a, b) => {
                        const indexA = getGadgetTypeIndex(a);
                        const indexB = getGadgetTypeIndex(b);

                        // å…ˆæŒ‰ç±»å‹æ’åº
                        if (indexA !== indexB) {
                            return indexA - indexB;
                        }

                        // ç±»å‹ç›¸åŒåˆ™æŒ‰åç§°æ’åº
                        return a.game.localeCompare(b.game);
                    });

                    return gadgets;
                });

                // è¿‡æ»¤é“å…·
                const filteredGadgets = computed(() => {
                    const query = searchQuery.value.toLowerCase();
                    return currentGadgets.value.filter(gadget => {
                        return gadget.game.toLowerCase().includes(query);
                    });
                });

                // åœ¨ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®
                onMounted(() => {
                    loadWeaponData();
                });

                return {
                    searchQuery,
                    activeTab,
                    filteredGadgets,
                    loading,
                    error
                };
            }
        }).mount('#app');
    </script>
</body>

</html>
